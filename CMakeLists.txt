cmake_minimum_required(VERSION 3.20)
project(mtsum CXX)

if (MSVC)
    set(CMAKE_CXX_STANDARD 20)
    set(CMAKE_CXX_FLAGS_DEBUG "-Zi -DDEBUG")
    set(CMAKE_CXX_FLAGS_RELEASE "-O2")
else ()
    set(CMAKE_CXX_STANDARD 20)
    if (WIN32)
        set(CMAKE_CXX_FLAGS_DEBUG "-g -O0 -DDEBUG")
        set(CMAKE_CXX_FLAGS_RELEASE "-O3")
    else ()
        set(CMAKE_CXX_FLAGS_DEBUG "-g -O0 -DDEBUG")
        set(CMAKE_CXX_FLAGS_RELEASE "-O3")
    endif ()
endif ()

set(CMAKE_EXE_LINKER_FLAGS "-static -static-libgcc -static-libstdc++")

find_package(argparse CONFIG REQUIRED)
find_package(OpenSSL REQUIRED)
find_package(llfio CONFIG REQUIRED)
find_package(Threads REQUIRED)
find_package(Taskflow CONFIG REQUIRED)

if (WIN32)
    set(LLFIO_LIB llfio::dl)
else ()
    set(LLFIO_LIB llfio::hl)
endif ()

add_executable(mtsum src/mtsum.cpp)
target_link_libraries(mtsum PRIVATE argparse::argparse Taskflow::Taskflow OpenSSL::Crypto ${LLFIO_LIB})
target_link_options(mtsum PRIVATE -static-libgcc -static-libstdc++)
